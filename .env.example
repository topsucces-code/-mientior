# PostgreSQL connection for Prisma
# ============================================
# Option 1: Local PostgreSQL / Docker
# PRISMA_DATABASE_URL=postgresql://mientior:mientior_password_2024@localhost:5432/mientior_db?schema=app
# DIRECT_URL=postgresql://mientior:mientior_password_2024@localhost:5432/mientior_db?schema=app

# Option 2: Supabase (recommended for production)
# Get these from: Supabase Dashboard > Settings > Database > Connection string
PRISMA_DATABASE_URL="postgresql://postgres.[PROJECT-REF]:Elisee1983ecom@aws-0-[REGION].pooler.supabase.com:6543/postgres?pgbouncer=true"
DIRECT_URL="postgresql://postgres.[PROJECT-REF]:Elisee1983ecom@aws-0-[REGION].pooler.supabase.com:5432/postgres"

# Redis for caching and sessions
REDIS_URL=redis://localhost:6379

# Search Configuration
# Similarity threshold for fuzzy search (0.0 to 1.0)
# Lower values = more results but less relevant
# Higher values = fewer results but more relevant
# Recommended: 0.3 for autocomplete, 0.4 for spell correction
SEARCH_SIMILARITY_THRESHOLD=0.3

# Word similarity threshold for multi-word queries
# Used by pg_trgm word_similarity() function
SEARCH_WORD_SIMILARITY_THRESHOLD=0.3

# Spell correction threshold for zero-result queries
# Higher threshold = more accurate corrections but fewer suggestions
# Recommended: 0.4 (higher than autocomplete to ensure quality)
SEARCH_SPELL_CORRECTION_THRESHOLD=0.4

# Search History Configuration
# Maximum number of search history entries per user (default: 10)
SEARCH_HISTORY_MAX_ENTRIES=10

# Search Cache TTLs (in seconds)
SUGGESTIONS_CACHE_TTL=3600        # 1 hour - autocomplete suggestions
SEARCH_CACHE_TTL=1800             # 30 minutes - search results
FACETS_CACHE_TTL=300              # 5 minutes - dynamic facets

# Enable facets caching (default: true)
ENABLE_FACETS_CACHE=true

# Cache Warming Configuration
CACHE_WARMING_ENABLED=true        # Enable automatic cache warming
CACHE_WARMING_TOP_QUERIES=50      # Number of top queries to pre-warm
CACHE_WARMING_PERIOD_DAYS=7       # Days of history for popularity analysis

# Cache Metrics Configuration
CACHE_METRICS_ENABLED=true        # Enable cache hit/miss tracking
CACHE_METRICS_RETENTION_HOURS=24  # Hours to retain metrics data

# MeiliSearch Configuration
# URL for MeiliSearch instance (Docker: http://localhost:7700, Production: your-meilisearch-url)
MEILISEARCH_URL=http://localhost:7700

# Master key for MeiliSearch (generate a secure random key for production)
# Generate with: openssl rand -base64 32
MEILISEARCH_MASTER_KEY=changeme_meilisearch_master_key_here

# Enable MeiliSearch for search (default: false, use PostgreSQL FTS)
# Set to true to use MeiliSearch instead of PostgreSQL for search
ENABLE_MEILISEARCH=false

# MeiliSearch index prefix (useful for multi-tenant or staging environments)
MEILISEARCH_INDEX_PREFIX=mientior_

# Synonym Management (optional)
# SYNONYMS_FILE_PATH=synonyms.json  # Path to synonyms file (default: synonyms.json in project root)
# SYNONYMS_CACHE_TTL=300  # Cache TTL in seconds (default: 300 = 5 minutes)

# A/B Testing for Search Engines
# Enable A/B testing to compare PostgreSQL FTS vs MeiliSearch performance
# When enabled, users are randomly assigned to one of two variants (50/50 split)
# Metrics are tracked and can be viewed in admin dashboard at /api/admin/search/ab-test-metrics
# Set to true to enable, false to use ENABLE_MEILISEARCH flag for all users
# Recommended: Run for at least 7 days to get meaningful data
ENABLE_SEARCH_AB_TEST=false

# Search Indexer: Automatic synchronization between PostgreSQL and MeiliSearch
# Requires ENABLE_MEILISEARCH=true to function
# Worker process: npm run search:worker
SEARCH_INDEXER_ENABLED=true                    # Enable automatic indexing via Prisma middleware
SEARCH_INDEXER_BATCH_SIZE=1000                 # Number of products to index per batch
SEARCH_INDEXER_MAX_RETRIES=3                   # Max retry attempts for failed jobs
SEARCH_INDEXER_POLL_INTERVAL=1000              # Worker poll interval in milliseconds
SEARCH_INDEXER_BACKOFF_BASE=2                  # Exponential backoff base for retries

# PIM Sync Worker Configuration
# Synchronizes products from Akeneo PIM to Mientior database
# Worker process: npm run pim:worker
PIM_SYNC_WORKER_ENABLED=true                   # Enable/disable the PIM sync worker process (true/false)
PIM_SYNC_WORKER_POLL_INTERVAL=5000             # Polling interval in milliseconds when queue is empty (default: 5000ms)

# Akeneo PIM Frontend Configuration
# Base URL of the Akeneo web interface (not the API root)
# Used to build "View in Akeneo" links in the admin panel
# Example: https://akeneo.yourcompany.com
NEXT_PUBLIC_AKENEO_API_URL=https://akeneo.example.com

# PIM Health Monitoring Configuration
# Optional: Configure thresholds for PIM sync health alerts
# These values control when alerts are triggered in the admin dashboard

# Percentage of failed syncs to trigger alert (default: 10%)
PIM_SYNC_FAILURE_THRESHOLD=10

# Seconds since last sync to trigger delay alert (default: 3600 = 1 hour)
PIM_SYNC_DELAY_THRESHOLD=3600

# Seconds of sync history to analyze for health checks (default: 86400 = 24 hours)
PIM_SYNC_HEALTH_CHECK_WINDOW=86400

# Product Ranking Configuration
# Controls how product relevance/popularity is calculated and applied in search results
# Popularity = views * VIEWS_WEIGHT + sales * SALES_WEIGHT
# Boosts applied: inStock (+10%), featured (+20%), rating (+rating*5%)
# After changing these values, run: npm run ranking:sync
RANKING_POPULARITY_VIEWS_WEIGHT=0.3            # Weight for product views in popularity (0.0-1.0)
RANKING_POPULARITY_SALES_WEIGHT=0.7            # Weight for sales in popularity (0.0-1.0)
RANKING_BOOST_IN_STOCK=10                      # Percentage boost for in-stock products (e.g., 10 = +10%)
RANKING_BOOST_FEATURED=20                      # Percentage boost for featured products (e.g., 20 = +20%)
RANKING_BOOST_RATING_MULTIPLIER=5              # Multiplier for rating-based boost (e.g., 5 = rating * 5%)
RANKING_AUTO_UPDATE_ENABLED=true               # Auto-update popularity on orders (default: true)

# Personalization Configuration
# Controls how user preferences are calculated and applied in search results
# Preferences are calculated from user behavior: purchases, searches, and views
# After changing these values, run: npm run personalization:calculate
PERSONALIZATION_PURCHASES_WEIGHT=0.5           # Weight for purchase history (0.0-1.0, highest intent signal)
PERSONALIZATION_SEARCHES_WEIGHT=0.3            # Weight for search history (0.0-1.0, interest signal)
PERSONALIZATION_VIEWS_WEIGHT=0.2               # Weight for product views (0.0-1.0, awareness signal)
PERSONALIZATION_CATEGORY_BOOST=15              # Percentage boost for favorite categories (e.g., 15 = +15%)
PERSONALIZATION_BRAND_BOOST=10                 # Percentage boost for favorite brands (e.g., 10 = +10%)
PERSONALIZATION_MIN_INTERACTIONS=3             # Minimum interactions to consider a category/brand as favorite

# Revalidation API secret (for on-demand ISR)
REVALIDATION_SECRET=changeme_revalidation_secret_here

# Better Auth
BETTER_AUTH_SECRET=better_auth_secret_here
BETTER_AUTH_URL=http://localhost:3000

# OAuth providers
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Paystack (https://paystack.com)
NEXT_PUBLIC_PAYSTACK_PUBLIC_KEY=pk_test_xxxxxxxxxxxxxxxx
PAYSTACK_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxx
PAYSTACK_WEBHOOK_SECRET=your_paystack_webhook_secret

# Flutterwave (https://flutterwave.com)
NEXT_PUBLIC_FLUTTERWAVE_PUBLIC_KEY=FLWPUBK_TEST-xxxxxxxxxxxxxxxx
FLUTTERWAVE_SECRET_KEY=FLWSECK_TEST-xxxxxxxxxxxxxxxx
FLUTTERWAVE_ENCRYPTION_KEY=FLWSECK_TESTxxxxxxxx
FLUTTERWAVE_WEBHOOK_SECRET=your_flutterwave_webhook_secret

# Payment Gateway Configuration
# Options: 'paystack' | 'flutterwave' | 'both'
PAYMENT_GATEWAY=both

# Shipping & Tax Configuration
# Free shipping threshold in cents (default: 50000 = 500 units)
# Note: Free shipping applies only within the same African region
FREE_SHIPPING_THRESHOLD=50000

# Default VAT rates by region
DEFAULT_VAT_WEST_AFRICA=16
DEFAULT_VAT_CENTRAL_AFRICA=17
DEFAULT_VAT_EAST_AFRICA=16
DEFAULT_VAT_SOUTHERN_AFRICA=15
DEFAULT_VAT_NORTH_AFRICA=17

# Enable weight-based shipping calculation (default: false)
# If true, products must have a weight field in the database
# If false, uses default weight per product for estimates
ENABLE_WEIGHT_BASED_SHIPPING=false

# Default product weight in grams (used if weight not specified)
# Default: 500g per product
DEFAULT_PRODUCT_WEIGHT=500

# Shipping calculation cache TTL in seconds (default: 3600 = 1 hour)
SHIPPING_CALC_CACHE_TTL=3600

# Tax calculation cache TTL in seconds (default: 3600 = 1 hour)
TAX_CALC_CACHE_TTL=3600

# Base shipping rates in cents (examples)
# West Africa
SHIPPING_WEST_AFRICA_STANDARD=2500
SHIPPING_WEST_AFRICA_EXPRESS=5000

# Central Africa
SHIPPING_CENTRAL_AFRICA_STANDARD=3500
SHIPPING_CENTRAL_AFRICA_EXPRESS=7000

# East Africa
SHIPPING_EAST_AFRICA_STANDARD=2800
SHIPPING_EAST_AFRICA_EXPRESS=5500

# Southern Africa
SHIPPING_SOUTHERN_AFRICA_STANDARD=3000
SHIPPING_SOUTHERN_AFRICA_EXPRESS=6000

# North Africa
SHIPPING_NORTH_AFRICA_STANDARD=2200
SHIPPING_NORTH_AFRICA_EXPRESS=4500

# International
SHIPPING_INTERNATIONAL_STANDARD=8000
SHIPPING_INTERNATIONAL_EXPRESS=15000

# Stripe (for Apple Pay / Google Pay processing)
# Get credentials from https://dashboard.stripe.com/
STRIPE_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxx
STRIPE_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxx

# Express Checkout - Apple Pay
# Obtain merchant certificate from https://developer.apple.com/account/
# 1. Create Merchant ID in Apple Developer portal
# 2. Generate Merchant Identity Certificate
# 3. Download certificate and private key as .pem files
APPLE_PAY_MERCHANT_ID=merchant.com.mientior
APPLE_PAY_CERT_PATH=/path/to/merchant_id.pem
APPLE_PAY_KEY_PATH=/path/to/merchant_id_key.pem

# Express Checkout - Google Pay
# Uses Stripe or Paystack for token processing
# Merchant ID from Google Pay Business Console
GOOGLE_PAY_MERCHANT_ID=BCR2DN4ABCDEFGH
GOOGLE_PAY_MERCHANT_NAME=Mientior Marketplace

# Express Checkout - PayPal
# Get credentials from https://developer.paypal.com/
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_client_secret
PAYPAL_MODE=sandbox
# or for production: PAYPAL_MODE=live
PAYPAL_API_URL=https://api-m.sandbox.paypal.com
# or for production: PAYPAL_API_URL=https://api-m.paypal.com

# Resend (email)
RESEND_API_KEY=your_resend_api_key
EMAIL_FROM=noreply@mientior.com

# Newsletter Integration
# If using an external service like Mailchimp or SendGrid:
# NEWSLETTER_API_KEY=your_newsletter_service_api_key
# NEWSLETTER_LIST_ID=your_mailing_list_id

# Instagram Graph API Integration
# Get these credentials from https://developers.facebook.com/
# 1. Create a Facebook App
# 2. Add Instagram Graph API product
# 3. Get a User Access Token with 'instagram_basic' permission
# 4. Exchange it for a Long-Lived Access Token (valid for 60 days)
# Note: You'll need to refresh the token before it expires
INSTAGRAM_ACCESS_TOKEN=your_instagram_long_lived_access_token
INSTAGRAM_USER_ID=your_instagram_business_account_id

# Cloudinary (optional for media storage)
CLOUDINARY_CLOUD_NAME=your_cloud
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# Analytics
NEXT_PUBLIC_POSTHOG_KEY=phc_XXXXXXXXXXXXXXXX
NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com

# Performance Monitoring (optional)
# For tracking Core Web Vitals and performance metrics
NEXT_PUBLIC_ANALYTICS_ID=your_analytics_tracking_id

# App
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_SERVER_URL=http://localhost:3000

# Pusher (for real-time notifications)
# Server-side credentials (keep private)
PUSHER_APP_ID=your_pusher_app_id
PUSHER_KEY=your_pusher_key
PUSHER_SECRET=your_pusher_secret
PUSHER_CLUSTER=your_pusher_cluster
# Public credentials (safe to expose in browser)
NEXT_PUBLIC_PUSHER_KEY=your_pusher_key
NEXT_PUBLIC_PUSHER_CLUSTER=your_pusher_cluster
# Note: NEXT_PUBLIC_PUSHER_KEY and PUSHER_KEY are typically the same value
# Pusher is used for real-time admin notifications:
# - Order created/updated events
# - Low stock alerts
# - Bulk operation completions
# Sign up at https://pusher.com to get your credentials

# Rate Limiting
RATE_LIMIT_WINDOW=60
RATE_LIMIT_MAX=100

# Admin
ADMIN_DEFAULT_EMAIL=admin@mientior.com
ADMIN_DEFAULT_PASSWORD=changeme_admin_password_here

# Feature Flags
FEATURE_FLAGS_ENABLED=true

# Sentry (optional for centralized logging)
SENTRY_DSN=your_sentry_dsn
